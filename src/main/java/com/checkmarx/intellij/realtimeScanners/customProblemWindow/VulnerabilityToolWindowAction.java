package com.checkmarx.intellij.realtimeScanners.customProblemWindow;

import com.intellij.openapi.actionSystem.AnActionEvent;
import com.intellij.openapi.project.DumbAware;
import com.intellij.openapi.project.Project;
import com.intellij.openapi.wm.ToolWindow;
import com.intellij.openapi.wm.ToolWindowManager;
import com.intellij.ui.content.Content;
import com.intellij.ui.content.ContentManager;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;

import java.util.Optional;

/**
 * Marks actions as vulnerability tool window actions,
 * allowing easy access to the VulnerabilityToolWindow panel.
 */
public interface VulnerabilityToolWindowAction extends DumbAware {

    /**
     * Get the Vulnerability tool window panel for a given event.
     */
    @Nullable
    default VulnerabilityToolWindow getVulnerabilityToolWindow(@NotNull AnActionEvent e) {
        if (e.getProject() == null) {
            return null;
        }
        return getVulnerabilityToolWindow(e.getProject());
    }

    /**
     * Get the Vulnerability tool window panel for a given project.
     */
    @Nullable
    default VulnerabilityToolWindow getVulnerabilityToolWindow(@NotNull Project project) {
        ToolWindowManager toolWindowManager = ToolWindowManager.getInstance(project);
        ToolWindow toolWindow = toolWindowManager.getToolWindow("VulnerabilityToolWindow");
        if (toolWindow == null) {
            return null;
        }
        ContentManager contentManager = toolWindow.getContentManager();
        Content content = contentManager.getContent(0);
        if (content == null) {
            return null;
        }
        return (VulnerabilityToolWindow) content.getComponent();
    }

    /**
     * Refresh the panel to reflect changes.
     */
    default void refreshPanel(@NotNull Project project) {
        Optional.ofNullable(getVulnerabilityToolWindow(project)).ifPresent(VulnerabilityToolWindow::refreshPanel);
    }
}
